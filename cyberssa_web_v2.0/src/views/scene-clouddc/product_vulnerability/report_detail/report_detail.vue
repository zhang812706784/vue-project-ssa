<template>
  <div class="report-result">
    <section class="header">
      <div>
        <div class="tool-bar">
          <Icon type="ios-help" color="skyblue" size="24" style="margin-right:8px"></Icon>
          <Select v-model="downloadFileType" filterable size="small" style="width:160px;vertical-align:super;margin-right:8px">
            <Option v-for="item in downloadFileTypeList" :value="item" :key="item">{{ item }}</Option>
          </Select>
          <Icon type="ios-download" color="#11CD6E" size="24" style="margin-right:8px"></Icon>
          <Icon type="clipboard" color="skyblue" size="24" style="margin-right:8px"></Icon>
          <Icon type="clipboard" color="skyblue" size="24" style="margin-right:8px"></Icon>
          <Icon type="clipboard" color="skyblue" size="24" style="margin-right:8px"></Icon>
          <Icon type="help-buoy" @click.native="goResult()" color="lightgreen" size="24" style="margin-right:8px"></Icon>
          <div style="width:200px;display:inline-block;vertical-align:super">
            <Progress :percent="80">
              <span>done</span>
            </Progress>
          </div>

        </div>
        <div class="title">
          <Dropdown class="chart-item-title-menu" placement="bottom-start">
            <h1>
              <Icon type="clipboard" color="skyblue" style="margin-right:8px"></Icon>Reports: {{selectReportType}}(3 of 39)</h1>
            <DropdownMenu slot="list">
              <DropdownItem v-for="item in selectReportTypeList" :key="item" @click="selectReportType = item">{{item}}</DropdownItem>
            </DropdownMenu>
          </Dropdown>
        </div>
      </div>
    </section>
    <section class="content">
      <tp-table ref="reportResultTable" :all_params="reportResultTableParams">
      </tp-table>
    </section>
    <Modal v-model="showAddNoteModal" title="New Note" ok-text="创建">
      <Form inline label-position="left">
        <FormItem label="NVT name" :label-width="100">
          <Input type="text" readonly v-model="testNoteData.NVTName" />
        </FormItem>
        <FormItem label="Active" :label-width="100">
          <RadioGroup v-model="testNoteData.active" vertical>
            <Radio label="yes,always"></Radio>
            <Radio label="yes,for the next">
           
            </Radio>
               <Input type="text" readonly v-model="testNoteData.NVTName" />
          </RadioGroup>
        </FormItem>
        <FormItem label="漏洞位置" :label-width="100">
          <Input type="text" placeholder="自定义搜索条件" />
        </FormItem>
        <FormItem label="漏洞最多的地区" :label-width="100">
          <Input type="text" placeholder="自定义搜索条件" />
        </FormItem>
      </Form>
    </Modal>
  </div>
</template>

<script>
import TpTable from '@/components/locale-components/tp-table/tp-table';
import TpSsaEcharts from '@/components/locale-components/tp-ssa-echarts/tp-ssa-echarts';
import mixin from '../mixin/mixin';
import moment from 'moment';
export default {
  name: 'report_detail',
  components: { TpSsaEcharts, TpTable },
  mixins: [mixin],
  data() {
    return {
      testNoteData: {
        NVTName: 'HP Integrated Lights-Out 4 Multiple Remote Vulnerabilities',
        active: 'always',
        hosts: 'any',
        location: 'any',
        severity: 'any',
        task: 'any',
        result: ''
      },
      showAddNoteModal: false,
      selectReportTypeList: [
        'Summary and Download',
        'Results (305)',
        'Vulnerabilities (139)',
        'Hosts (1)',
        'Ports',
        'Applications (5)',
        'Operating Systems (2)',
        'CVEs',
        'Closed CVEs (0)',
        'SSL Certificates (2)',
        'Error Messages (3)'
      ],
      selectReportType: 'Summary and Download',
      testData: [
        'HP Integrated Lights-Out 4 Multiple Remote Vulnerabilities',
        'phpinfo() output accessible',
        'SSL/TLS: OpenSSL CCS Man in the Middle Security Bypass Vulnerability',
        'HTTP Debugging Methods (TRACE/TRACK) Enabled',
        'SSL/TLS: Certificate Expired',
        'SSL/TLS: Report Vulnerable Cipher Suites for HTTPS',
        'SSL/TLS: Report Vulnerable Cipher Suites for HTTPS',
        'Apache Subversion Module Metadata Accessible',
        'SSL/TLS: SSLv3 Protocol CBC Cipher Suites Information Disclosure Vulnerability (POODLE)',
        'SSL/TLS: Report Weak Cipher Suites',
        'SSL/TLS: Deprecated SSLv2 and SSLv3 Protocol Detection',
        'Add NoteAdd Override SSL/TLS: Deprecated SSLv2 and SSLv3 Protocol Detection',
        'SSL/TLS: Certificate Signed Using A Weak Signature Algorithm'
      ],
      downloadFileTypeList: [
        'Anonymous XML',
        'ARF',
        'CPE',
        'CSV Hosts',
        'CSV Results',
        'HTML',
        'ITG',
        'LaTeX',
        'NEB',
        'PDF',
        'Topology SVG',
        'TXT',
        'Verinice ISM',
        'Verinice ITG',
        'XML'
      ],
      downloadFileType: 'Anonymous',
      reportResultTableParams: {}
    };
  },
  created() {
    this.reportResultTableParams = {
      id: 'report_table',
      ajaxType: 'get',
      index: false,
      loading: false,
      checkBox: false,
      url: '/api/ssa_table',
      data: {
        index: 'asset',
        type: 'vm'
      },
      add_btn: false,
      del_btn: false,
      modify_btn: false,
      cols: [
        {
          title: this.$t('Vulnerability'),
          render: (h, params) => {
            return this.createALink(
              h,
              this.testData[parseInt(Math.random() * this.testData.length)],
              'result_detail',
              params.row
            );
          }
        },
        {
          title: this.$t('Serverity'),
          render: (h, params) => {
            return this.createProgress(h, 'High', 10);
          }
        },
        {
          title: this.$t('QoD')
        },
        {
          title: this.$t('Host'),
          render: (h, params) => {
            return this.createALink(
              h,
              params.row._source.vmIp,
              'host_detail',
              params.row
            );
          }
        },
        {
          title: this.$t('Location')
        },
        {
          title: this.$t('Actions'),
          render: (h, params) => {
            return h('div', [
              this.createAIconBtn(
                h,
                {
                  type: 'edit'
                },
                () => {
                  this.showAddNoteModal = true;
                }
              )
            ]);
          }
        }
      ]
    };
  },
  filters: {
    timeFormat: function(value) {
      return moment(value).format('YYYY-MM-DD hh:mm:ss');
    }
  },
  beforeRouteEnter(to, from, next) {
    next(vm => {
      vm.getReportDetail();
    });
  },
  methods: {
    getReportDetail() {},
    goResult() {
      // 前往结果列表页面
      console.log('go result list');
      this.$router.push({ path: 'result' });
    },
    addNote() {}
  }
};
</script>

<style scoped>
@import '../common_css/common_css.css';
.report-result {
  /** 最外层div css 设置有问题 需要在底部补上高度**/
  color: white;
  padding: 0 8px 108px;
  box-sizing: border-box;
}

.ivu-icon {
  cursor: pointer;
}
</style>
