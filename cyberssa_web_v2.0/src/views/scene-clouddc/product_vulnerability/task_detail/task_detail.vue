<template>
  <div class="task">
    <section class="task-detail">
      <div class="header">
        <div>
          <div class="tool-bar">
            <Icon type="ios-help" color="skyblue" size="24" style="margin-right:8px"></Icon>
            <Icon type="ios-trash" color="red" size="24" style="margin-right:8px"></Icon>
            <Icon type="ios-copy" color="green" size="24" style="margin-right:8px"></Icon>
            <Icon type="android-settings" color="blue" size="24" style="margin-right:8px"></Icon>
            <Icon type="ios-download" color="#11CD6E" size="24" style="margin-right:8px"></Icon>
          </div>
          <div class="title">
            <h1>
              <Icon type="clipboard" color="skyblue" style="margin-right:8px"></Icon>Task:{{taskDetail.vmName}}</h1>
          </div>
        </div>

      </div>
      <div class="content">
        <table>
          <tr v-for="(val,key) in taskDetail">
            <td>
              {{key}}
            </td>
            <td>
              {{val}}
            </td>
          </tr>
        </table>
      </div>
    </section>
    <section class="user-tags">
      <div class="header">
        <div class="title">
          <h1>
            <Icon type="clipboard" color="skyblue" style="margin-right:8px"></Icon>User Tags (none)
          </h1>
        </div>
        <div>
          <Icon type="android-add-circle" color="#11CD6E" size="24" style="margin-right:8px"></Icon>
          <Icon type="ios-help" color="skyblue" size="24" style="margin-right:8px"></Icon>
          <!-- <Icon type="android-contract" color="skyblue" size="24" style="margin-right:8px"></Icon> -->
          <Icon type="android-expand" color="red" size="24" style="margin-right:8px"></Icon>
        </div>
      </div>
      <div class="content"></div>
    </section>
    <section class="permissions">
      <div class="header">
        <div class="title">
          <h1>
            <Icon type="clipboard" color="skyblue" style="margin-right:8px"></Icon>Permissions (none)
          </h1>
        </div>
        <div>
          <Icon type="android-add-circle" color="#11CD6E" size="24" style="margin-right:8px"></Icon>
          <Icon type="ios-help" color="skyblue" size="24" style="margin-right:8px"></Icon>
          <!-- <Icon type="android-contract" color="skyblue" size="24" style="margin-right:8px"></Icon> -->
          <Icon type="android-expand" color="red" size="24" style="margin-right:8px"></Icon>
        </div>
      </div>
      <div class="content">
        <tp-table ref="permissionsTable" :all_params="permissionsTableParams"></tp-table>
      </div>
    </section>
  </div>
</template>

<script>
import TpTable from '@/components/locale-components/tp-table/tp-table';
import TpSsaEcharts from '@/components/locale-components/tp-ssa-echarts/tp-ssa-echarts';
import moment from 'moment';
// 这里混入了一些 生成表格内部 a Progress IconBtn 的方法  可以重写 也可以修改
import mixin from '../mixin/mixin';
export default {
  name: 'task_detail',
  components: { TpSsaEcharts, TpTable },
  mixins: [mixin],
  data() {
    return {
      taskDetail: {},
      permissionsTableParams: {}
    };
  },
  created() {
    this.permissionsTableParams = {
      id: 'permissions_table',
      index: false,
      loading: false,
      checkBox: false,
      // url: '/ssa/java/asset/group/groupList',
      type: 'table',
      // ajaxType: 'get',
      add_btn: false,
      del_btn: false,
      modify_btn: false,
      cols: [
        {
          title: this.$t('Name')
        },
        {
          title: this.$t('Description')
        },
        {
          title: this.$t('Resource Type')
        },
        {
          title: this.$t('Resource')
        },
        {
          title: this.$t('Subject Type')
        },
        {
          title: this.$t('Subject')
        },
        {
          title: this.$t('Actions')
        }
      ]
    };
  },
  // 时间格式过滤器
  filters: {
    timeFormat: function(value) {
      return moment(value).format('YYYY-MM-DD hh:mm:ss');
    }
  },
  beforeRouteEnter(to, from, next) {
    // 如果有路由缓存的话 这里必须要加上 然后 进入路由时调用方法
    next(vm => {
      vm.getTaskDetail();
    });
  },
  methods: {
    getTaskDetail() {
      // 异步获取一个数据
      setTimeout(() => {
        this.taskDetail = this.$route.params._source || {};
        console.log(this.taskDetail);
        // mock data 此处数据结构和接口数据不同 请注意
        this.taskDetail = Object.assign(this.taskDetail, {
          comment: '',
          target: '1.194.144.230',
          alerts: '',
          schedule: '(Next due:over)',
          addToAssets: {
            value: 'yes',
            children: {
              applyOverrides: 'yes',
              minQod: '70%'
            }
          },
          alerableTask: 'no',
          autoDelateReports: 'Do not automaticelly delete reports',
          scanner: {
            value: 'OpenVAS Default (Type: OpenVAS Scanner)',
            children: {
              scanConfig: 'Full and fast',
              orderForTargetHosts: 'Sequential',
              networkSourceInterface: '',
              maximumConcurrentlyExecutedNVTsPerHost: '4',
              maximumConcurrentlyScannedHosts: 20
            }
          },
          status: 'Done',
          durationOfLastScan: '25 seconds',
          averageScanDuration: '33 minutes 17 seconds',
          reports: '3(Finished:2,Last:Aug 24 2018)',
          notes: 0,
          overrides: 0,
          results: '34'
        });
      }, 1000);
    }
  }
};
</script>

<style scoped>
@import '../common_css/common_css.css';
.task {
  /** 最外层div css 设置有问题 需要在底部补上高度**/
  color: white;
  padding: 0 8px 108px;
  box-sizing: border-box;
}
</style>
